/*!
 * NUO v1.1.0
 * (c) 2018 crossjs
 * Released under the MIT License.
 */
"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var setImmediate=_interopDefault(require("core-js/library/fn/set-immediate"));function isObject(t){return"object"==typeof t}function isFunction(t){return"function"==typeof t}var Handler=function(t,n,e,o,r,i){this.onFulfilled=isFunction(t)?t:null,this.onRejected=isFunction(n)?n:null,this.onProgress=isFunction(e)?e:null,this.resolve=o,this.reject=r,this.notify=i},Nuo=function(t){var n=this;if(!isNuo(this))throw new TypeError("Promises must be constructed via new");if(!isFunction(t))throw new TypeError("The first argument must be a function");this.state=0,this.value=null,this.sofar=null,this.deferred=[],doResolve(t,function(t){return n.resolve(t)},function(t){return n.reject(t)},function(t){return n.notify(t)})};function doResolve(t,n,e,o){var r=!1;try{t(function(t){r||(r=!0,n(t))},function(t){r||(r=!0,e(t))},function(t){r||o(t)})}catch(t){if(r)return;r=!0,e(t)}}function isNuo(t){return t instanceof Nuo}Nuo.resolve=function(n){return isNuo(n)?n:new Nuo(function(t){return t(n)})},Nuo.reject=function(e){return new Nuo(function(t,n){return n(e)})},Nuo.notify=function(o){return new Nuo(function(t,n,e){return e(o)})},Nuo.all=function(c){return new Nuo(function(o,r,i){if(0===c.length)return o([]);var u=c.length;function s(n,t){try{if(t&&(isObject(t)||isFunction(t))){var e=t.then;if(isFunction(e))return void e.call(t,function(t){s(n,t)},r,i)}c[n]=t,0==--u&&o(c)}catch(t){r(t)}}for(var t=0,n=u;t<n;t++)s(t,c[t])})},Nuo.race=function(i){return new Nuo(function(t,n,e){for(var o=0,r=i.length;o<r;o++)Nuo.resolve(i[o]).then(t,n,e)})},Nuo.any=function(e){return new Nuo(function(o,r,i){if(0===e.length)return r();var u=e.length;function s(n,t){try{if(t&&(isObject(t)||isFunction(t))){var e=t.then;if(isFunction(e))return void e.call(t,function(t){s(n,t)},r,i)}o(t)}catch(t){r(t)}0==--u&&r()}for(var t=0,n=u;t<n;t++)s(t,e[t])})},Nuo.prototype.catch=function(t){return this.then(null,t)},Nuo.prototype.finally=function(n){return this.then(function(t){return Nuo.resolve(n()).then(function(){return t})},function(t){return Nuo.resolve(n()).then(function(){throw t})})},Nuo.prototype.progress=function(t){return this.then(null,null,t)},Nuo.prototype.then=function(o,r,i){var u=this;return new Nuo(function(t,n,e){u.handle(new Handler(o,r,i,t,n,e))})},Nuo.prototype.handle=function(e){var o=this;if(0!==this.state)setImmediate(function(){var t=1===o.state?e.onFulfilled:e.onRejected;if(t)try{var n=t(o.value);e.resolve(n)}catch(t){e.reject(t)}else(1===o.state?e.resolve:e.reject)(o.value)});else{this.deferred.push(e);var t=e.onProgress;t&&null!==this.sofar&&setImmediate(function(){t(o.sofar)})}},Nuo.prototype.finale=function(t){for(var n=0,e=this.deferred,o=e.length;n<o;n++)this.handle(e[n]);t||(this.deferred=[])},Nuo.prototype.resolve=function(o){var n=this;try{if(o===this)throw new TypeError("A promise cannot be resolved with itself.");if(o&&(isObject(o)||isFunction(o))){var r=o.then;if(isFunction(r))return void doResolve(function(t,n,e){r.call(o,t,n,e)},function(t){return n.resolve(t)},function(t){return n.reject(t)},function(t){return n.notify(t)})}this.state=1,this.value=o,this.finale()}catch(t){this.reject(t)}},Nuo.prototype.reject=function(t){this.state=2,this.value=t,this.finale()},Nuo.prototype.notify=function(t){this.sofar=t,this.finale(!0)},module.exports=Nuo;